import{r as v,e as M,c as m,o as d,a as s,w as y,f as I,t as p,v as C,g as T,F,l as z,h as E,i as q,j,k as O,d as B,m as k,n as $,u as x,p as P,b as W,q as Z,s as G,x as U,y as D,z as H,A as J,B as Q,C as R,D as X,E as Y,G as ee,H as te,I as se}from"./index-BJyr7T4-.js";import{s as L,e as ne,w as ae}from"./index-D6qEvwj7.js";import{F as oe}from"./FullScreenLoading-DQfNarns.js";const le={class:"flex flex-col gap-3 w-full justify-center items-cente my-2"},ue={class:"text-center text-xl font-bold"},re={class:"mt-2 flex justify-center"},ie={__name:"LoginBox",emits:["login-success"],setup(V,{emit:f}){const i=f,l=v(!0),t=v({email:"demo@gmail.com",password:"asdfghjkl;",nickname:""});M(l,()=>{t.value={email:t.value.email,password:"",nickname:""}});const w=()=>{l.value?z({email:t.value.email,password:t.value.password}).then(r=>{sessionStorage.setItem("token",r.data?.token),sessionStorage.setItem("nickname",r.data?.nickname),L({title:"登入成功！"}).then(()=>{i("login-success",{name:r.data.nickname}),t.value={email:"",password:"",nickname:""}})}).catch(r=>{ne({text:r?.response?.data?.message??"請稍後再試",confirmButtonText:"前往註冊",cancelButtonText:"我再想想"}).then(a=>{if(a.isConfirmed){l.value=!1,t.value={email:t.value.email,password:"",nickname:""};return}})}):E({email:t.value.email,password:t.value.password,nickname:t.value.nickname}).then(r=>{L({title:"註冊成功！",confirmButtonText:"點我登入"}).then(()=>{l.value=!0,t.value={email:t.value.email,password:"",nickname:""}})}).catch(r=>{ae({title:"註冊失敗！",text:r?.response?.data?.message??"請稍後再試",confirmButtonText:"重新輸入"})}).then(()=>{l.value=!1,t.value={email:t.value.email,password:"",nickname:t.value.nickname}})};return(r,a)=>(d(),m(F,null,[s("div",le,[s("p",ue,p(l.value?"登入":"註冊")+" TodoList ",1),l.value?I("",!0):y((d(),m("input",{key:0,"onUpdate:modelValue":a[0]||(a[0]=u=>t.value.nickname=u),type:"text",placeholder:"請輸入暱稱",class:"border-2 border-gray-500 rounded-md p-2 w-full"},null,512)),[[C,t.value.nickname]]),y(s("input",{"onUpdate:modelValue":a[1]||(a[1]=u=>t.value.email=u),type:"email",placeholder:"請輸入信箱",class:"border-2 border-gray-500 rounded-md p-2 w-full"},null,512),[[C,t.value.email]]),y(s("input",{"onUpdate:modelValue":a[2]||(a[2]=u=>t.value.password=u),type:"password",placeholder:"請輸入密碼",class:"border-2 border-gray-500 rounded-md p-2 w-full"},null,512),[[C,t.value.password]])]),s("div",null,[s("button",{type:"button",onClick:w,class:"border-2 border-orange-400 rounded-md p-2 w-full"},p(l.value?"登入":"註冊"),1),s("div",re,[T(p(l.value?"尚未註冊？":"已有帳號？")+" ",1),s("button",{class:"text-blue-900 font-bold",type:"button",onClick:a[3]||(a[3]=u=>l.value=!l.value)},p(l.value?"前往註冊":"回到登入頁"),1)])])],64))}},de={class:"my-2"},ce={class:"flex items-center gap-4 w-full mt-2"},me={class:"list-disc list-inside my-4 max-h-[300px] overflow-y-auto"},pe={class:"flex items-center gap-2 flex-1"},ve=["onUpdate:modelValue","onChange"],fe={class:"w-full flex items-end justify-between"},ge=["onKeyup","onUpdate:modelValue"],xe={key:1},ke={key:0,class:"flex gap-2 text-xl mr-3"},ye={__name:"ToDoList",props:{userInfo:{type:Object,required:!0}},emits:["update:loading"],setup(V,{emit:f}){const i=v(null),l=o=>{i.value=o},t=o=>{ee(o.id,{content:o.content}).then(()=>L({title:"更新成功！"})).then(()=>b()).finally(()=>{i.value=null})},w=f,r=o=>w("update:loading",o),a=v(""),u=()=>{const o={content:a.value};Y(o).then(n=>{L({title:"新增成功！"}).then(()=>{a.value="",b()})})},S=o=>{if(o==null)return"";const n=Number(o);if(Number.isNaN(n))return"";const e=Math.abs(n)<1e12?n*1e3:n,c=new Date(e),A=new Intl.DateTimeFormat("zh-TW",{timeZone:"Asia/Taipei",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(c).replaceAll("/","-"),K=new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Taipei",weekday:"short"}).format(c).toLowerCase();return`${A} (${K})`},h=v("now"),N=q(()=>(g.value.sort((o,n)=>o.status-n.status),h.value==="all"?g.value:h.value==="done"?g.value.filter(o=>o.status):g.value.filter(o=>!o.status))),g=v([]),b=()=>{r(!0),X().then(o=>{g.value=o.data.data}).finally(()=>{r(!1)})};return j(()=>{b()}),(o,n)=>{const _=O("el-icon");return d(),m(F,null,[s("p",null,p(V.userInfo.name)+"，歡迎回來！",1),s("p",de,[n[4]||(n[4]=T(" 共有 ",-1)),s("span",{class:"text-blue-600 cursor-pointer",onClick:n[0]||(n[0]=e=>h.value="all")},p(g.value.length),1),n[5]||(n[5]=T(" 項待辦事項，已完成 ",-1)),s("span",{class:"text-green-600 cursor-pointer",onClick:n[1]||(n[1]=e=>h.value="done")},p(g.value.filter(e=>e.status).length),1),n[6]||(n[6]=T(" 項，剩餘 ",-1)),s("span",{class:"text-red-600 cursor-pointer",onClick:n[2]||(n[2]=e=>h.value="now")},p(g.value.filter(e=>!e.status).length),1),n[7]||(n[7]=T(" 項待辦事項，加油！ ",-1))]),s("div",null,[s("div",ce,[y(s("input",{type:"text","onUpdate:modelValue":n[3]||(n[3]=e=>a.value=e),onKeyup:B(u,["enter"]),placeholder:"請輸入待辦事項",class:"border p-2 rounded-md flex-1"},null,544),[[C,a.value]]),s("button",{class:"flex h-full",type:"button",onClick:u},[k(_,{size:"20",color:"#374151"},{default:$(()=>[k(x(P))]),_:1})])]),s("ul",me,[(d(!0),m(F,null,W(N.value,e=>(d(),m("li",{key:e.id,class:"mb-2 gap-2 list-none flex justify-between"},[s("label",pe,[y(s("input",{type:"checkbox","onUpdate:modelValue":c=>e.status=c,onKeyup:B(u,["enter"]),onChange:c=>{r(!0),x(G)(e.id).then(b)},class:"mr-2"},null,40,ve),[[Z,e.status]]),s("div",fe,[i.value===e.id?y((d(),m("input",{key:0,type:"text",onKeyup:B(c=>t(e),["enter"]),"onUpdate:modelValue":c=>e.content=c,class:U(["border p-1 rounded-md w-full",{"line-through text-gray-500":e.status}])},null,42,ge)),[[C,e.content]]):(d(),m("div",xe,[s("span",{class:U({"line-through text-gray-500":e.status})},p(e.content),3),s("span",{class:U(["text-[12px] text-gray-600 ml-2",{"line-through text-gray-500":e.status}])},p(S(e.createTime)),3)]))])]),e.status?I("",!0):(d(),m("div",ke,[i.value===null?(d(),D(_,{key:0,color:"#165DFF",class:"cursor-pointer",onClick:c=>l(e.id)},{default:$(()=>[k(x(H))]),_:2},1032,["onClick"])):I("",!0),i.value===e.id?(d(),D(_,{key:1,onClick:c=>t(e),color:"#00C851",class:"cursor-pointer"},{default:$(()=>[k(x(J))]),_:2},1032,["onClick"])):I("",!0),k(_,{color:"#FF3B30",class:"cursor-pointer",onClick:c=>x(R)(e.id).then(()=>{x(L)({title:"刪除成功！"}).then(()=>{b()})})},{default:$(()=>[k(x(Q))]),_:2},1032,["onClick"])]))]))),128))])])],64)}}},we={class:"flex flex-col items-center justify-center h-full"},he={class:"flex flex-col min-w-[450px] min-h-[300px] bg-amber-200 px-10 py-5 rounded-4xl"},Se={__name:"WeekTwo",setup(V){const f=v(!1),i=v(!0),l=v({name:"demo default"}),t=v(sessionStorage.getItem("token")),w=a=>{t&&(l.value={name:a.name},f.value=!0)},r=()=>{se().then(a=>{f.value=!0,l.value={name:localStorage.getItem("nickname")||"demo default"}}).catch(a=>{console.error("err",a),sessionStorage.removeItem("nickname"),sessionStorage.removeItem("token"),f.value=!1,i.value=!1})};return j(()=>{r()}),(a,u)=>(d(),m("div",we,[k(oe,{isLoading:i.value},null,8,["isLoading"]),u[2]||(u[2]=s("p",{class:"align mb-5 text-xl font-bold"},"第二周 - 註冊、登入、驗證token，含todolist",-1)),s("div",he,[f.value?(d(),m(F,{key:0},[k(ye,{userInfo:l.value,loading:i.value,"onUpdate:loading":u[0]||(u[0]=S=>i.value=S)},null,8,["userInfo","loading"]),s("button",{type:"button",class:"mt-auto self-end px-2 py-1 rounded-md bg-orange-600 text-white",onClick:u[1]||(u[1]=S=>{x(te)().then(()=>{i.value=!0,r()})})}," 登出 ")],64)):(d(),D(ie,{key:1,onLoginSuccess:w}))])]))}};export{Se as default};
